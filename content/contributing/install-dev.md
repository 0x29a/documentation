Title: Developer Environment
Date: 2021-04-12
Order: 2

## Prerequisites

These instructions assume you are developing BookWyrm using Docker. You'll need to [install Docker](https://docs.docker.com/engine/install/) and [docker-compose](https://docs.docker.com/compose/install/) to get started.

## Setting up the developer environment

- Get a copy of [the BookWyrm codebase from GitHub](https://github.com/bookwyrm-social/bookwyrm). You can [create a fork](https://docs.github.com/en/get-started/quickstart/fork-a-repo) of the repository, and then [use `git clone` to download the code](https://docs.github.com/en/github/creating-cloning-and-archiving-repositories/cloning-a-repository-from-github/cloning-a-repository) to your computer.
- Go to the directory which contains the code on your computer, you'll be working from there from here on out.
- Set up your development environment variables file by copying the dev example file (`.env.dev.example`) into a new file named `.env`. In the command line, you can do this with:
```
:::bash linenums=False
cp .env.dev.example .env
```
- Optionally, you can use a service like [ngrok](https://ngrok.com/) to set up a domain name, and set the `DOMAIN` variable in your `.env` file to the domain name generated by ngrok.

- Set up nginx for development by coping the developer nginx configuration file (`nginx/development`) into a new file named `nginx/default.conf`:
```
:::bash linenums=False
cp nginx/development nginx/default.conf
```

- Start the application. In the command line, run:
```
:::shell linenums=False
docker-compose build
docker-compose run --rm web python manage.py migrate
docker-compose run --rm web python manage.py initdb
docker-compose up
```
- Once the build is complete, you can access the instance at `http://localhost:1333`

### Editing or creating Models

If you change or create a model, you will probably change the database structure. In order for these changes to take effect you will need to `makemigrations` to create a new [Django migrations file](https://docs.djangoproject.com/en/3.2/topics/migrations):

```
:::shell linenums=False
docker-compose run --rm web python manage.py makemigrations
```

### Editing static files
If you edit the CSS or JavaScript, you will need to run Django's `collectstatic` command in order for your changes to have effect. You can do this by running:
```
:::shell linenums=False
./bw-dev collectstatic
```

If you have [installed yarn](https://yarnpkg.com/getting-started/install), you can run `yarn watch:static` to automatically run the previous script every time a change occurs in `bookwyrm/static` directory.

